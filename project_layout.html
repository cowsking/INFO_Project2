<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<style>
  .state {
    fill: lightgrey;
  }

  .outline {
    stroke: black;
    stroke-width: 1px;
    fill: none;
  }
</style>

<body>
  <div class="container">
    <h2>Find some features ..</h2>
    <a href="#" class="btn-gradient cyan mini" id="gen">#Gender#</a>
    <a href="#" class="btn-gradient orange mini" id="rac">#Race#</a>
    <a href="#" class="btn-gradient blue mini" id="par">#Party#</a>
  </div>

  <select name="cars" id="cars">
    <option value="volvo">Party</option>
    <option value="saab">Sex</option>
    <option value="mercedes">Race</option>
  </select>

  <br />Filter<br />
  Median Household Income
  <select name="cars" id="cars">
    <option value="volvo">Above</option>
    <option value="saab">Below</option>
  </select>

  <form style="display: inline"><input type="number" value="0" /></form>
  <br />
  Percent with a Bachelor's or Higher
  <select name="cars" id="cars">
    <option value="volvo">Above</option>
    <option value="saab">Below</option>
  </select>
  <form style="display: inline"><input type="number" value="0" /></form>
  <br />

  Percent of Population of a certain race/ethnicity
  <select name="cars" id="cars">
    <option value="volvo">Asian</option>
    <option value="saab">Black</option>
    <option value="saab">Hispanic</option>
    <option value="saab">White</option>
  </select>

  <select name="cars" id="cars">
    <option value="volvo">Above</option>
    <option value="saab">Below</option>
  </select>
  <form style="display: inline"><input type="number" value="0" /></form>
  <br />
  <!-- <svg height="700" width="1400" style="border: 1px solid black"></svg> -->
  <div id="main" height="700" width="1400"></div>
</body>
<script>
  const main = d3.select("div#main");

  const svg = main
    .append("svg")
    .attr("width", 1100)
    .attr("height", 580)
    .style("margin", 20);
  // svg.append("text").attr("x", 350).attr("y", 260).text("USA Map goes here");

  const width = svg.attr("width");
  const height = svg.attr("height");
  margin = 20;
  const mapWidth = width - margin - margin;
  const mapHeight = height - margin - margin;
  const map = svg
    .append("g")
    .attr("transform", "translate(" + 20 + "," + 20 + ")");

  // const name = document.querySelector("container");
  // const btn = document.querySelector("button");
  // btn.addEventListener("click", changemap());

  const requestData = async function () {
    const us_house = await d3.json("./us-house.topojson");
    // const us_house = await d3.json("./us-house.geojson");
    console.log(us_house);
    var zips = topojson.feature(us_house, us_house.objects["us-house-us-house"]);
    var zipsMesh = topojson.mesh(us_house, us_house.objects["us-house-us-house"]);

    console.log(zips)
    // console.log(us_house);
    // var center = d3.geo.centroid(us_house)
    // var scale = 1000;
    var projection = d3
      .geoMercator()
      .fitSize([mapWidth, mapHeight], zips);
    // .scale(scale)
    // .translate([mapWidth / 2 + 1670, mapHeight / 2 + 700]);
    // var path = d3.geoPath().projection(projection);
    var path = d3.geoPath().projection(projection);

    // zips.features.forEach(d => {
    //   console.log(d.properties.ethnicity);
    // });

    function genderColor(gender) {
      if (gender == "male") {
        return "#75CDEF";
      }
      if (gender == "female") {
        return "#FF6B6B";
      }
    }

    function partyColor(party) {
      if (party == "democrat") {
        return "#75CDEF";
      }
      if (party == "republican") {
        return "#FF6B6B";
      }
    }

    function raceColor(race) {
      if (race == "white-american") {
        return "#75CDEF";
      }
      if (race == "african-american") {
        return "#BC514C";
      }
      if (race == "hispanic-american") {
        return "#F15E61";
      }
      if (race == "asian-american") {
        return "#F1A55E";
      }
      if (race == "multi-racial-american") {
        return "#A55EF1";
      }
      if (race == "native-american") {
        return "#5EF1A5";
      }
    }
    
    map.append("path").datum(zipsMesh)
        .attr("class", "outline")
        .attr("d", path)
        .attr("stroke", "white")
        .attr("stroke-width", 2);

    let btnGen = document.getElementById("gen");
    btnGen.onclick = function () {
      map.selectAll("path.state").data(zips.features)
        .join("path")
        .attr("class", "state")
        .attr("d", path)
        .style("fill", d => genderColor(d.properties.gender));

      map.append("path").datum(zipsMesh)
        .attr("class", "outline")
        .attr("d", path)
        .attr("stroke", "white")
        .attr("stroke-width", 2);
    };

    let btnPar = document.getElementById("par");
    btnPar.onclick = function () {
      map.selectAll("path.state").data(zips.features)
        .join("path")
        .attr("class", "state")
        .attr("d", path)
        .style("fill", d => partyColor(d.properties.party));

      map.append("path").datum(zipsMesh)
        .attr("class", "outline")
        .attr("d", path)
        .attr("stroke", "white")
        .attr("stroke-width", 2);
    };

    let btnRac = document.getElementById("rac");
    btnRac.onclick = function () {
      map.selectAll("path.state").data(zips.features)
        .join("path")
        .attr("class", "state")
        .attr("d", path)
        .style("fill", d => raceColor(d.properties.ethnicity));

      map.append("path").datum(zipsMesh)
        .attr("class", "outline")
        .attr("d", path)
        .attr("stroke", "white")
        .attr("stroke-width", 2);
    };
  };
  requestData();

  // svg
  //   .append("circle")
  //   .attr("cx", 1200)
  //   .attr("cy", 350)
  //   .attr("r", 150)
  //   .style("fill", "lightblue");
  // svg.append("text").attr("x", 1100).attr("y", 350).text("pie chart goes here");
</script>